<form class="sw5e-helper-damage">

  {{!-- ================= Header ================= --}}
  <header class="hdr">
    <h2>{{localize "SW5EHELPER.DamageTitle"}}</h2>
  </header>

  {{!-- ============== Favorites Row ============== --}}
  <section class="row favorites">
    <label for="presetName">{{localize "SW5EHELPER.Favorites"}}</label>
    <select name="presetName" id="presetName">
      <option value="">{{localize "SW5EHELPER.None"}}</option>
      {{#each presets}}
        <option value="{{this.name}}" {{#if this.selected}}selected{{/if}}>{{this.name}}</option>
      {{/each}}
    </select>

    <button type="button" class="btn" data-action="save">{{localize "SW5EHELPER.Save"}}</button>
    <button type="button" class="btn warn" data-action="delete">{{localize "SW5EHELPER.Delete"}}</button>
  </section>

  {{!-- ============ Quick Presets Row ============ --}}
  <section class="row quick">
    <button type="button" class="btn" data-action="load-last">{{localize "SW5EHELPER.LoadLastUsed"}}</button>
    <button type="button" class="btn ghost" data-action="clear">{{localize "SW5EHELPER.Clear"}}</button>
  </section>

  {{!-- =========== Weapon Selection Row ========== --}}
  <section class="row weapon">
    <label for="weaponId">{{localize "SW5EHELPER.Weapon"}}</label>
    <select name="weaponId" id="weaponId">
      {{#each weapons}}
        <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>{{this.name}}</option>
      {{/each}}
    </select>
  </section>

  {{!-- ======== Universal Options Row 1 ========= --}}
  <section class="row uni1">
    <label for="ability">{{localize "SW5EHELPER.Ability"}}</label>
    <select name="ability" id="ability">
      <option value="">{{localize "SW5EHELPER.Default"}}</option>
      {{#each abilities}}
        <option value="{{this}}" {{#if (eq ../ability this)}}selected{{/if}}>{{this}}</option>
      {{/each}}
    </select>

    <label class="chk offhand">
      <input type="checkbox" name="offhand" {{#if offhand}}checked{{/if}}>
      {{localize "SW5EHELPER.OffHand"}}
    </label>
  </section>

  {{!-- ======= Smart Weapon Override Row ========= --}}
  <section class="row smart">
    <label class="chk">
      <input type="checkbox" name="smart" {{#if smart}}checked{{/if}}>
      {{localize "SW5EHELPER.SmartWeapon"}}
    </label>

    <label for="smartAbility">{{localize "SW5EHELPER.SmartAbility"}}</label>
    <input type="number" id="smartAbility" name="smartAbility" value="{{smartAbility}}" style="width:4.2rem;">

    {{!-- No proficiency for damage in Smart mode --}}
  </section>

  {{!-- ======== Additional Mods (builder) ========= --}}
  <section class="row addmods">
    <div class="bar" style="display:flex;gap:.5rem;align-items:center;">
      <label>{{localize "SW5EHELPER.ExtraModsDmg"}}</label>
      <button type="button" class="btn" data-action="add-row">{{localize "SW5EHELPER.AddMod"}}</button>
    </div>
    <div class="modlist">
      {{#each extraRows}}
      <div class="modrow" data-id="{{this.id}}" style="display:flex;gap:.5rem;align-items:center;margin:.25rem 0;">
        <input type="text" class="mod-formula" value="{{this.formula}}" placeholder="{{localize 'SW5EHELPER.ExtraModsDmgPH'}}" style="flex:1;">
        <select class="mod-type">
          {{#each ../damageTypes}}
            <option value="{{this}}" {{#if (eq ../this.type this)}}selected{{/if}}>{{this}}</option>
          {{/each}}
        </select>
        <label class="chk"><input type="checkbox" class="mod-incrit" {{#if this.inCrit}}checked{{/if}}> {{localize "SW5EHELPER.IncludeInCrit"}}</label>
        <button type="button" class="btn warn" data-action="del-row" title="{{localize 'SW5EHELPER.Delete'}}">ðŸ—‘</button>
      </div>
      {{/each}}
    </div>
  </section>

  {{!-- ---- Min die (temporary testing UI) ---- --}}
<section class="row mindie">
  <label class="chk">
    <input type="checkbox" name="useMinDie" {{#if useMinDie}}checked{{/if}}>
    {{localize "SW5EHELPER.UseMinDie"}}
  </label>
  <small style="opacity:.75;">
    (d4â†’2, d6â†’2, d8â†’3, d10â†’4, d12â†’5, d20â†’8)
  </small>
</section>

  {{!-- ---- Once-per-turn features ---- --}}
  <section class="row once">
    <label class="lbl">{{localize "SW5EHELPER.OncePerTurn"}}</label>
    <label class="chk">
      <input type="checkbox" name="otpDamageAdv" {{#if otpDisabled}}disabled{{/if}} {{#if otpDamageAdv}}checked{{/if}}>
      {{localize "SW5EHELPER.DmgAdv"}}
    </label>
    <label class="chk">
      <input type="checkbox" name="otpDamageDis" {{#if otpDisabled}}disabled{{/if}} {{#if otpDamageDis}}checked{{/if}}>
      {{localize "SW5EHELPER.DmgDis"}}
    </label>
  </section>

  {{!-- ---- Flags: Crit / Separate Per Target ---- --}}
  <section class="row flags">
    <label class="chk">
      <input type="checkbox" name="crit" {{#if crit}}checked{{/if}}>
      {{localize "SW5EHELPER.Crit"}}
    </label>

    <label class="chk">
      <input type="checkbox" name="separate" {{#if separate}}checked{{/if}}>
      {{localize "SW5EHELPER.SeparatePerTargetDmg"}} <small>(disables once-per-turn)</small>
    </label>
  </section>

  {{!-- ============ Roll Mode (radio) ============ --}}
  <section class="row rollmode">
    <label><input type="radio" name="advMode" value="adv"    {{#if (eq adv "adv")}}checked{{/if}}>    {{localize "SW5EHELPER.Adv"}}</label>
    <label><input type="radio" name="advMode" value="normal" {{#if (eq adv "normal")}}checked{{/if}}> {{localize "SW5EHELPER.Normal"}}</label>
    <label><input type="radio" name="advMode" value="dis"    {{#if (eq adv "dis")}}checked{{/if}}>    {{localize "SW5EHELPER.Disadv"}}</label>
  </section>

  {{!-- ============ Footer (Roll/Cancel) ========== --}}
  <footer class="row footer">
    <button type="button" class="btn primary" data-action="roll">Roll</button>
    <button type="button" class="btn cancel" data-action="cancel">{{localize "SW5EHELPER.Cancel"}}</button>
  </footer>

</form>
